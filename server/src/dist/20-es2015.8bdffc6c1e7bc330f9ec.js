(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{THZu:function(t,e,a){"use strict";a.r(e),a.d(e,"SolicitacoesListaModule",(function(){return V}));var i=a("ofXK"),c=a("tyNb"),o=a("mrSG"),n=a("aceb"),r=a("vI6V"),s=a("8/IB"),b=a("wHSu"),u=a("3Pt+"),l=a("fXoL");function d(t,e){if(1&t&&l.Tb(0,"textarea",5),2&t){const t=l.kc(2);l.qc("formControl",t.justificativa)}}function f(t,e){if(1&t&&(l.Yb(0,"div"),l.Yb(1,"nb-checkbox",3),l.Ic(2,"Aprovar cancelamento(s)"),l.Xb(),l.Gc(3,d,1,1,"textarea",4),l.Xb()),2&t){const t=l.kc();l.Fb(1),l.qc("formControl",t.cancelado),l.Fb(2),l.qc("ngIf",!t.cancelado.value)}}function h(t,e){1&t&&(l.Yb(0,"div"),l.Ic(1," Voc\xea tem certeza que deseja alterar o status das solicita\xe7\xf5es? "),l.Xb())}let g=(()=>{class t{constructor(t){this.ref=t,this.cancelado=new u.d(!1),this.justificativa=new u.d("")}ngOnInit(){this.cancelamento=this.status===r.d.SLC_CANCELAMENTO}cancel(){this.ref.close({submit:!1})}submit(){this.ref.close({submit:!0,cancelamento:{cancelado:this.cancelado.value,justificativa:this.justificativa.value}})}}return t.\u0275fac=function(e){return new(e||t)(l.Sb(n.J))},t.\u0275cmp=l.Mb({type:t,selectors:[["ngx-dialog-showcase"]],inputs:{status:"status"},decls:11,vars:2,consts:[[4,"ngIf"],["nbButton","","status","danger",1,"cancel",3,"click"],["nbButton","","status","success",3,"click"],["fullWidth","",3,"formControl"],["fullWidth","","nbInput","","placeholder","Justificativa",3,"formControl",4,"ngIf"],["fullWidth","","nbInput","","placeholder","Justificativa",3,"formControl"]],template:function(t,e){1&t&&(l.Yb(0,"nb-card"),l.Yb(1,"nb-card-header"),l.Ic(2,"Confirme a altera\xe7\xe3o de status"),l.Xb(),l.Yb(3,"nb-card-body"),l.Gc(4,f,4,2,"div",0),l.Gc(5,h,2,0,"div",0),l.Xb(),l.Yb(6,"nb-card-footer"),l.Yb(7,"button",1),l.gc("click",(function(){return e.cancel()})),l.Ic(8,"Cancelar"),l.Xb(),l.Yb(9,"button",2),l.gc("click",(function(){return e.submit()})),l.Ic(10,"Alterar"),l.Xb(),l.Xb(),l.Xb()),2&t&&(l.Fb(4),l.qc("ngIf",e.cancelamento),l.Fb(1),l.qc("ngIf",!e.cancelamento))},directives:[n.u,n.x,n.t,i.m,n.v,n.q,n.A,u.n,u.e,n.P,u.b],styles:["input[_ngcontent-%COMP%]{width:100%}.cancel[_ngcontent-%COMP%]{margin-right:2rem}"]}),t})();var m=a("aetl"),p=a("L8hi"),S=a("sWYD"),v=a("6NWb");function X(t,e){1&t&&(l.Yb(0,"nb-alert",43),l.Ic(1," Especifique o status na pesquisa para poder altera-lo!\n"),l.Xb())}function Y(t,e){1&t&&(l.Yb(0,"nb-alert",43),l.Ic(1," N\xe3o \xe9 poss\xedvel alterar status de solicita\xe7\xf5es pagas!\n"),l.Xb())}function k(t,e){1&t&&(l.Yb(0,"nb-alert",43),l.Ic(1," N\xe3o \xe9 poss\xedvel alterar status de solicita\xe7\xf5es canceladas!\n"),l.Xb())}function C(t,e){if(1&t&&(l.Yb(0,"nb-option",44),l.Ic(1),l.Xb()),2&t){const t=e.$implicit;l.qc("value",t.k),l.Fb(1),l.Jc(t.v)}}function D(t,e){if(1&t&&(l.Yb(0,"nb-option",44),l.Ic(1),l.Xb()),2&t){const t=e.$implicit;l.qc("value",t._id),l.Fb(1),l.Jc(t.name)}}function G(t,e){if(1&t&&(l.Yb(0,"nb-list-item"),l.Yb(1,"div",45),l.Ic(2),l.Xb(),l.Yb(3,"div",46),l.Ic(4),l.Xb(),l.Xb()),2&t){const t=e.$implicit;l.Fb(2),l.Kc(" ",t.produto[0]&&t.produto[0].nome||"-"," "),l.Fb(2),l.Kc(" ",t.count," ")}}function T(t,e){1&t&&l.Tb(0,"tr",47)}function q(t,e){1&t&&l.Tb(0,"tr",48),2&t&&l.qc("clickToToggle",!1)}function I(t,e){if(1&t){const t=l.Zb();l.Yb(0,"th",49),l.Yb(1,"button",50),l.gc("click",(function(){return l.Ac(t),l.kc().alterarStatusSelecionados()})),l.Tb(2,"fa-icon",5),l.Xb(),l.Xb()}if(2&t){const t=l.kc();l.Fb(1),l.qc("disabled",!t.filtroStatus||"PAGO"===t.filtroStatus||"CANCELADO"===t.filtroStatus),l.Fb(1),l.qc("icon",t.faExchangeAlt)}}function F(t,e){if(1&t&&l.Tb(0,"nb-tree-grid-row-toggle",54),2&t){const t=l.kc().$implicit;l.qc("expanded",t.expanded)}}function P(t,e){if(1&t){const t=l.Zb();l.Yb(0,"nb-checkbox",55),l.gc("checkedChange",(function(e){l.Ac(t);const a=l.kc().$implicit;return l.kc().toggle(e,a)})),l.Xb()}if(2&t){const t=l.kc().$implicit,e=l.kc();l.qc("disabled",!e.filtroStatus||"PAGO"===e.filtroStatus||"CANCELADO"===e.filtroStatus)("checked",e.isChecked(t))}}function A(t,e){if(1&t&&(l.Yb(0,"td",51),l.Gc(1,F,1,1,"nb-tree-grid-row-toggle",52),l.Gc(2,P,1,2,"nb-checkbox",53),l.Xb()),2&t){const t=e.$implicit;l.Fb(1),l.qc("ngIf",t.children),l.Fb(1),l.qc("ngIf",t.children)}}function N(t,e){if(1&t&&(l.Yb(0,"th",56),l.Ic(1," Usu\xe1rio/Produto "),l.Xb()),2&t){const t=l.kc();l.qc("nbSortHeader",t.getSortDirection("nome"))}}function w(t,e){if(1&t&&(l.Yb(0,"td",51),l.Ic(1),l.Xb()),2&t){const t=e.$implicit;l.Fb(1),l.Kc(" ",t.data.nome," ")}}function O(t,e){if(1&t&&(l.Yb(0,"th",56),l.Ic(1," Status/Qtd. Solicitada "),l.Xb()),2&t){const t=l.kc();l.qc("nbSortHeader",t.getSortDirection("uq"))}}function y(t,e){if(1&t&&(l.Yb(0,"td",51),l.Ic(1),l.Xb()),2&t){const t=e.$implicit;l.Fb(1),l.Kc(" ",t.data.uq," ")}}function j(t,e){if(1&t&&(l.Yb(0,"th",56),l.Ic(1," Valor "),l.Xb()),2&t){const t=l.kc();l.qc("nbSortHeader",t.getSortDirection("valor"))}}function x(t,e){if(1&t&&(l.Yb(0,"td",51),l.Ic(1),l.Xb()),2&t){const t=e.$implicit;l.Fb(1),l.Kc(" ",t.data.valor," ")}}function L(t,e){if(1&t&&(l.Yb(0,"th",56),l.Ic(1," Data Desejada "),l.Xb()),2&t){const t=l.kc();l.qc("nbSortHeader",t.getSortDirection("dataDesejada"))}}function H(t,e){if(1&t&&(l.Yb(0,"td",51),l.Ic(1),l.Xb()),2&t){const t=e.$implicit;l.Fb(1),l.Kc(" ",t.data.dataDesejada," ")}}function B(t,e){if(1&t){const t=l.Zb();l.Yb(0,"button",57),l.gc("click",(function(){l.Ac(t);const e=l.kc();return e.mudarPagina(e.pageNumber-1)})),l.Ic(1),l.Xb()}if(2&t){const t=l.kc();l.Fb(1),l.Kc(" ",t.pageNumber-1," ")}}function E(t,e){if(1&t){const t=l.Zb();l.Yb(0,"button",57),l.gc("click",(function(){l.Ac(t);const e=l.kc();return e.mudarPagina(e.pageNumber+1)})),l.Ic(1),l.Xb()}if(2&t){const t=l.kc();l.Fb(1),l.Kc(" ",t.pageNumber+1," ")}}const R=function(){return["/pages/admin/solicitacoes/relatorio"]};let $=(()=>{class t{constructor(t,e,a,i,c,o){this.dataSourceBuilder=t,this.solicitacaoProdutoService=e,this.fb=a,this.toastrservice=i,this.dialogService=c,this.route=o,this.customColumn="nome",this.defaultColumns=[],this.allColumns=["action","nome","uq","valor","dataDesejada"],this.faSearch=b.h,this.faChartLine=b.e,this.faAngleRight=b.d,this.faAngleLeft=b.c,this.faAngleDoubleLeft=b.a,this.faAngleDoubleRight=b.b,this.nPerPage=10,this.pageNumber=1,this.filtroStatus="ABERTO",this.faExchangeAlt=b.f,this.status=Object.keys(r.d).map(t=>({k:t,v:r.d[t]})),this.sortDirection=n.ob.NONE,this.filtro=this.fb.group({dataCriacao:null,dataDesejada:null,status:null,usuario:null}),this.checkeds=new Set}ngOnInit(){return Object(o.a)(this,void 0,void 0,(function*(){this.route.queryParams.subscribe(t=>{const e=Object(m.a)(new Date),a=Object(p.a)(new Date);if(t&&Object.keys(t).length){const{dtDjEnd:e,dtDjStart:a,status:i,usuario:c}=t;this.filtro.patchValue({status:i,dataDesejada:{start:new Date(a),end:new Date(e)},usuario:c}),this.filtroStatus=i}else this.filtro.patchValue({status:"ABERTO",dataDesejada:{start:e,end:a},usuario:""});this.solicitacaoProdutoService.buscarSolicitacoesGeral(this.filtro.value,this.pageNumber,this.nPerPage).subscribe(t=>{this.setData(t.solicitacoes),this.setLastPageAndCount(t.count)}),this.solicitacaoProdutoService.countProdutos(this.filtro.value).subscribe(t=>this.produtosCount=t)}),this.solicitacaoProdutoService.usuariosSelect().subscribe(t=>this.usuarios=t)}))}setData(t){this.data=t.map(t=>{const e=t.produtos;delete t.produtos;const a=e.map(t=>({data:{uq:t.quantidade,nome:t.produto.nome,valor:`R$ ${t.valor.toFixed(2)}`}})),i=Object(S.a)(new Date(t.dataDesejada),"dd/MM/yyyy");return{data:{_id:t._id,nome:t.usuario.name,uq:r.d[t.status],valor:`R$ ${t.valorTotal.toFixed(2)}`,dataDesejada:i},children:a}}),this.dataSource=this.dataSourceBuilder.create(this.data)}buscar(){this.solicitacaoProdutoService.buscarSolicitacoesGeral(this.filtro.value,this.pageNumber,this.nPerPage).subscribe(t=>{this.setData(t.solicitacoes),this.setLastPageAndCount(t.count)}),this.solicitacaoProdutoService.countProdutos(this.filtro.value).subscribe(t=>this.produtosCount=t),this.filtroStatus=this.filtro.value.status,this.checkeds.clear()}mudarPagina(t){this.pageNumber=t,this.solicitacaoProdutoService.buscarSolicitacoes(this.filtro.value,this.pageNumber,this.nPerPage).subscribe(t=>{this.setData(t.solicitacoes),this.setLastPageAndCount(t.count)})}setLastPageAndCount(t){this.countSolicitacoes=t,this.nOfPages=Math.ceil(t/this.nPerPage)}alterarStatusTodos(){this.alterarStatus(this.data.map(t=>t.data._id))}alterarStatusSelecionados(){this.alterarStatus(Array.from(this.checkeds))}alterarStatus(t){this.dialogService.open(g,{context:{status:r.d[this.filtroStatus]}}).onClose.subscribe(e=>{e.submit&&this.solicitacaoProdutoService.alterarStatus(t,this.filtro.value.status,e.cancelamento).subscribe(t=>{this.toastrservice.success("","Status das solicita\xe7\xf5es foram alterados com sucesso"),this.buscar()})})}updateSort(t){this.sortColumn=t.column,this.sortDirection=t.direction}toggle(t,e){t?this.checkeds.add(e.data._id):this.checkeds.delete(e.data._id)}isChecked(t){return this.checkeds.has(t.data._id)}getSortDirection(t){return this.sortColumn===t?this.sortDirection:n.ob.NONE}getShowOn(t){return 400+100*t}}return t.\u0275fac=function(e){return new(e||t)(l.Sb(n.Eb),l.Sb(s.a),l.Sb(u.c),l.Sb(n.vb),l.Sb(n.K),l.Sb(c.a))},t.\u0275cmp=l.Mb({type:t,selectors:[["ngx-solicitacoes-lista"]],decls:92,vars:32,consts:[["status","warning",4,"ngIf"],[1,"row"],[1,"col-md-8"],[2,"display","flex","justify-content","space-between"],["nbTooltip","Ver relat\xf3rios","nbTooltipStatus","primary","nbButton","","status","basic","size","tiny",3,"disabled","routerLink"],[3,"icon"],[3,"formGroup"],[1,"row","form-group"],[1,"form-group","col-md-6"],["for","Nome","required","",1,"label"],["placeholder","Status","formControlName","status","fullWidth",""],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","Usuario","required","",1,"label"],["placeholder","Usu\xe1rio","formControlName","usuario","fullWidth",""],[1,"col-md-6"],[1,"label"],["fullWidth","","nbInput","","formControlName","dataCriacao",3,"nbDatepicker"],["rangepicker",""],["fullWidth","","nbInput","","formControlName","dataDesejada",3,"nbDatepicker"],["dataDesejada",""],["nbButton","","size","small",3,"click"],[2,"margin-right","5px",3,"icon"],[1,"col-md-4"],[2,"height","322px"],["nbTooltip","Alterar Status","nbTooltipStatus","primary","nbButton","","status","basic","size","tiny",3,"disabled","click"],[4,"ngFor","ngForOf"],[3,"nbTreeGrid","nbSort","sort"],["nbTreeGridHeaderRow","",4,"nbTreeGridHeaderRowDef"],["nbTreeGridRow","",3,"clickToToggle",4,"nbTreeGridRowDef","nbTreeGridRowDefColumns"],["nbTreeGridColumnDef","action"],["nbTreeGridHeaderCell","",4,"nbTreeGridHeaderCellDef"],["nbTreeGridCell","",4,"nbTreeGridCellDef"],[3,"nbTreeGridColumnDef"],["nbTreeGridHeaderCell","",3,"nbSortHeader",4,"nbTreeGridHeaderCellDef"],["nbTreeGridColumnDef","uq"],["nbTreeGridColumnDef","valor"],["nbTreeGridColumnDef","dataDesejada"],["nbButton","","ghost","",3,"disabled"],[3,"icon","click"],["nbButton","","ghost","",3,"disabled","click"],["nbButton","","ghost","",3,"click",4,"ngIf"],["nbButton","","ghost","","status","primary"],["status","warning"],[3,"value"],[1,"col-md-9"],[1,"col-md-3"],["nbTreeGridHeaderRow",""],["nbTreeGridRow","",3,"clickToToggle"],["nbTreeGridHeaderCell",""],["nbTooltip","Alterar status das solicita\xe7\xf5es selecionadas","nbTooltipStatus","primary","nbButton","","status","basic","size","tiny",3,"disabled","click"],["nbTreeGridCell",""],[3,"expanded",4,"ngIf"],[3,"disabled","checked","checkedChange",4,"ngIf"],[3,"expanded"],[3,"disabled","checked","checkedChange"],["nbTreeGridHeaderCell","",3,"nbSortHeader"],["nbButton","","ghost","",3,"click"]],template:function(t,e){if(1&t&&(l.Gc(0,X,2,0,"nb-alert",0),l.Gc(1,Y,2,0,"nb-alert",0),l.Gc(2,k,2,0,"nb-alert",0),l.Yb(3,"div",1),l.Yb(4,"div",2),l.Yb(5,"nb-card"),l.Yb(6,"nb-card-header"),l.Yb(7,"div",3),l.Yb(8,"div"),l.Ic(9," Filtro de Solicita\xe7\xf5es "),l.Xb(),l.Yb(10,"div"),l.Yb(11,"button",4),l.Tb(12,"fa-icon",5),l.Xb(),l.Xb(),l.Xb(),l.Xb(),l.Yb(13,"nb-card-body"),l.Yb(14,"form",6),l.Yb(15,"div",7),l.Yb(16,"div",8),l.Yb(17,"label",9),l.Ic(18,"Status"),l.Xb(),l.Yb(19,"nb-select",10),l.Yb(20,"nb-option",11),l.Ic(21,"Todos"),l.Xb(),l.Gc(22,C,2,2,"nb-option",12),l.Xb(),l.Xb(),l.Yb(23,"div",8),l.Yb(24,"label",13),l.Ic(25,"Usu\xe1rio"),l.Xb(),l.Yb(26,"nb-select",14),l.Yb(27,"nb-option",11),l.Ic(28,"Todos"),l.Xb(),l.Gc(29,D,2,2,"nb-option",12),l.Xb(),l.Xb(),l.Xb(),l.Yb(30,"div",1),l.Yb(31,"div",15),l.Yb(32,"label",16),l.Ic(33,"Data de cria\xe7\xe3o:"),l.Xb(),l.Tb(34,"input",17),l.Tb(35,"nb-rangepicker",null,18),l.Xb(),l.Yb(37,"div",15),l.Yb(38,"label",16),l.Ic(39,"Data desejada:"),l.Xb(),l.Tb(40,"input",19),l.Tb(41,"nb-rangepicker",null,20),l.Xb(),l.Xb(),l.Xb(),l.Xb(),l.Yb(43,"nb-card-footer"),l.Yb(44,"button",21),l.gc("click",(function(){return e.buscar()})),l.Tb(45,"fa-icon",22),l.Ic(46," Buscar"),l.Xb(),l.Xb(),l.Xb(),l.Xb(),l.Yb(47,"div",23),l.Yb(48,"nb-card",24),l.Yb(49,"nb-card-header"),l.Yb(50,"div",3),l.Yb(51,"div"),l.Ic(52," Produto / Quantidade "),l.Xb(),l.Yb(53,"div"),l.Yb(54,"button",25),l.gc("click",(function(){return e.alterarStatusTodos()})),l.Tb(55,"fa-icon",5),l.Xb(),l.Xb(),l.Xb(),l.Xb(),l.Yb(56,"nb-card-body"),l.Yb(57,"nb-list"),l.Gc(58,G,5,2,"nb-list-item",26),l.Xb(),l.Xb(),l.Xb(),l.Xb(),l.Xb(),l.Yb(59,"nb-card"),l.Yb(60,"nb-card-body"),l.Yb(61,"table",27),l.gc("sort",(function(t){return e.updateSort(t)})),l.Gc(62,T,1,0,"tr",28),l.Gc(63,q,1,1,"tr",29),l.Wb(64,30),l.Gc(65,I,3,2,"th",31),l.Gc(66,A,3,2,"td",32),l.Vb(),l.Wb(67,33),l.Gc(68,N,2,1,"th",34),l.Gc(69,w,2,1,"td",32),l.Vb(),l.Wb(70,35),l.Gc(71,O,2,1,"th",34),l.Gc(72,y,2,1,"td",32),l.Vb(),l.Wb(73,36),l.Gc(74,j,2,1,"th",34),l.Gc(75,x,2,1,"td",32),l.Vb(),l.Wb(76,37),l.Gc(77,L,2,1,"th",34),l.Gc(78,H,2,1,"td",32),l.Vb(),l.Xb(),l.Xb(),l.Yb(79,"nb-card-footer"),l.Yb(80,"button",38),l.Yb(81,"fa-icon",39),l.gc("click",(function(){return e.mudarPagina(1)})),l.Xb(),l.Xb(),l.Yb(82,"button",40),l.gc("click",(function(){return e.mudarPagina(e.pageNumber-2)})),l.Tb(83,"fa-icon",5),l.Xb(),l.Gc(84,B,2,1,"button",41),l.Yb(85,"button",42),l.Ic(86),l.Xb(),l.Gc(87,E,2,1,"button",41),l.Yb(88,"button",40),l.gc("click",(function(){return e.mudarPagina(e.pageNumber+2)})),l.Tb(89,"fa-icon",5),l.Xb(),l.Yb(90,"button",40),l.gc("click",(function(){return e.mudarPagina(e.nOfPages)})),l.Tb(91,"fa-icon",5),l.Xb(),l.Xb(),l.Xb()),2&t){const t=l.xc(36),a=l.xc(42);l.qc("ngIf",!e.filtroStatus),l.Fb(1),l.qc("ngIf","PAGO"===e.filtroStatus),l.Fb(1),l.qc("ngIf","CANCELADO"===e.filtroStatus),l.Fb(9),l.qc("disabled",!e.filtroStatus||"PAGO"===e.filtroStatus||"CANCELADO"===e.filtroStatus)("routerLink",l.sc(31,R)),l.Fb(1),l.qc("icon",e.faChartLine),l.Fb(2),l.qc("formGroup",e.filtro),l.Fb(8),l.qc("ngForOf",e.status),l.Fb(7),l.qc("ngForOf",e.usuarios),l.Fb(5),l.qc("nbDatepicker",t),l.Fb(6),l.qc("nbDatepicker",a),l.Fb(5),l.qc("icon",e.faSearch),l.Fb(9),l.qc("disabled",!e.filtroStatus||"PAGO"===e.filtroStatus||"CANCELADO"===e.filtroStatus),l.Fb(1),l.qc("icon",e.faExchangeAlt),l.Fb(3),l.qc("ngForOf",e.produtosCount),l.Fb(3),l.qc("nbTreeGrid",e.dataSource)("nbSort",e.dataSource),l.Fb(1),l.qc("nbTreeGridHeaderRowDef",e.allColumns),l.Fb(1),l.qc("nbTreeGridRowDefColumns",e.allColumns),l.Fb(4),l.qc("nbTreeGridColumnDef",e.customColumn),l.Fb(13),l.qc("disabled",1===e.pageNumber),l.Fb(1),l.qc("icon",e.faAngleDoubleLeft),l.Fb(1),l.qc("disabled",e.pageNumber<=2),l.Fb(1),l.qc("icon",e.faAngleLeft),l.Fb(1),l.qc("ngIf",e.pageNumber>1),l.Fb(2),l.Kc(" ",e.pageNumber," "),l.Fb(1),l.qc("ngIf",e.pageNumber<e.nOfPages),l.Fb(1),l.qc("disabled",e.pageNumber>=e.nOfPages-2),l.Fb(1),l.qc("icon",e.faAngleRight),l.Fb(1),l.qc("disabled",e.pageNumber===e.nOfPages),l.Fb(1),l.qc("icon",e.faAngleDoubleRight)}},directives:[i.m,n.u,n.x,n.q,n.yb,c.d,v.a,n.t,u.z,u.o,u.g,n.jb,u.n,u.f,n.gb,i.l,n.P,u.b,n.G,n.hb,n.v,n.Y,n.Db,n.pb,n.Ib,n.Lb,n.Cb,n.Fb,n.Ab,n.o,n.Z,n.Hb,n.Kb,n.Gb,n.Bb,n.Mb,n.A,n.qb],styles:[""]}),t})();var W=a("zQsl"),K=a("DKVz"),M=a("oG2T");let V=(()=>{class t{}return t.\u0275mod=l.Qb({type:t}),t.\u0275inj=l.Pb({factory:function(e){return new(e||t)},imports:[[i.c,n.r,n.y,W.b,K.a,n.kb,n.Q,n.y,n.k,n.p,u.u,u.h,n.H,n.Jb,n.ab,n.O,v.b,M.a.forChild({format:"dd/MM/yyyy"}),n.zb,n.B,n.I.forChild(),c.g.forChild([{path:"",component:$}])]]}),t})()}}]);