(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{THZu:function(t,e,a){"use strict";a.r(e),a.d(e,"SolicitacoesListaModule",(function(){return W}));var c=a("ofXK"),i=a("tyNb"),o=a("mrSG"),n=a("aceb"),r=a("vI6V"),s=a("wd/R"),b=a("8/IB"),u=a("wHSu"),l=a("3Pt+"),d=a("fXoL");function f(t,e){if(1&t&&d.Tb(0,"textarea",5),2&t){const t=d.kc(2);d.qc("formControl",t.justificativa)}}function h(t,e){if(1&t&&(d.Yb(0,"div"),d.Yb(1,"nb-checkbox",3),d.Ic(2,"Aprovar cancelamento(s)"),d.Xb(),d.Gc(3,f,1,1,"textarea",4),d.Xb()),2&t){const t=d.kc();d.Fb(1),d.qc("formControl",t.cancelado),d.Fb(2),d.qc("ngIf",!t.cancelado.value)}}function g(t,e){1&t&&(d.Yb(0,"div"),d.Ic(1," Voc\xea tem certeza que deseja alterar o status das solicita\xe7\xf5es? "),d.Xb())}let m=(()=>{class t{constructor(t){this.ref=t,this.cancelado=new l.d(!1),this.justificativa=new l.d("")}ngOnInit(){this.cancelamento=this.status===r.d.SLC_CANCELAMENTO}cancel(){this.ref.close({submit:!1})}submit(){this.ref.close({submit:!0,cancelamento:{cancelado:this.cancelado.value,justificativa:this.justificativa.value}})}}return t.\u0275fac=function(e){return new(e||t)(d.Sb(n.E))},t.\u0275cmp=d.Mb({type:t,selectors:[["ngx-dialog-showcase"]],inputs:{status:"status"},decls:11,vars:2,consts:[[4,"ngIf"],["nbButton","","status","danger",1,"cancel",3,"click"],["nbButton","","status","success",3,"click"],["fullWidth","",3,"formControl"],["fullWidth","","nbInput","","placeholder","Justificativa",3,"formControl",4,"ngIf"],["fullWidth","","nbInput","","placeholder","Justificativa",3,"formControl"]],template:function(t,e){1&t&&(d.Yb(0,"nb-card"),d.Yb(1,"nb-card-header"),d.Ic(2,"Confirme a altera\xe7\xe3o de status"),d.Xb(),d.Yb(3,"nb-card-body"),d.Gc(4,h,4,2,"div",0),d.Gc(5,g,2,0,"div",0),d.Xb(),d.Yb(6,"nb-card-footer"),d.Yb(7,"button",1),d.gc("click",(function(){return e.cancel()})),d.Ic(8,"Cancelar"),d.Xb(),d.Yb(9,"button",2),d.gc("click",(function(){return e.submit()})),d.Ic(10,"Alterar"),d.Xb(),d.Xb(),d.Xb()),2&t&&(d.Fb(4),d.qc("ngIf",e.cancelamento),d.Fb(1),d.qc("ngIf",!e.cancelamento))},directives:[n.p,n.s,n.o,c.m,n.q,n.l,n.v,l.n,l.e,n.K,l.b],styles:["input[_ngcontent-%COMP%]{width:100%}.cancel[_ngcontent-%COMP%]{margin-right:2rem}"]}),t})();var p=a("6NWb");function S(t,e){1&t&&(d.Yb(0,"nb-alert",43),d.Ic(1," Especifique o status na pesquisa para poder altera-lo!\n"),d.Xb())}function Y(t,e){1&t&&(d.Yb(0,"nb-alert",43),d.Ic(1," N\xe3o \xe9 poss\xedvel alterar status de solicita\xe7\xf5es pagas!\n"),d.Xb())}function v(t,e){1&t&&(d.Yb(0,"nb-alert",43),d.Ic(1," N\xe3o \xe9 poss\xedvel alterar status de solicita\xe7\xf5es canceladas!\n"),d.Xb())}function k(t,e){if(1&t&&(d.Yb(0,"nb-option",44),d.Ic(1),d.Xb()),2&t){const t=e.$implicit;d.qc("value",t.k),d.Fb(1),d.Jc(t.v)}}function X(t,e){if(1&t&&(d.Yb(0,"nb-option",44),d.Ic(1),d.Xb()),2&t){const t=e.$implicit;d.qc("value",t._id),d.Fb(1),d.Jc(t.name)}}function C(t,e){if(1&t&&(d.Yb(0,"nb-list-item"),d.Yb(1,"div",45),d.Ic(2),d.Xb(),d.Yb(3,"div",46),d.Ic(4),d.Xb(),d.Xb()),2&t){const t=e.$implicit;d.Fb(2),d.Kc(" ",t.produto[0]&&t.produto[0].nome||"-"," "),d.Fb(2),d.Kc(" ",t.count," ")}}function D(t,e){1&t&&d.Tb(0,"tr",47)}function G(t,e){1&t&&d.Tb(0,"tr",48),2&t&&d.qc("clickToToggle",!1)}function T(t,e){if(1&t){const t=d.Zb();d.Yb(0,"th",49),d.Yb(1,"button",50),d.gc("click",(function(){return d.Ac(t),d.kc().alterarStatusSelecionados()})),d.Tb(2,"fa-icon",25),d.Xb(),d.Xb()}if(2&t){const t=d.kc();d.Fb(1),d.qc("disabled",!t.filtroStatus||"PAGO"===t.filtroStatus||"CANCELADO"===t.filtroStatus),d.Fb(1),d.qc("icon",t.faExchangeAlt)}}function q(t,e){if(1&t&&d.Tb(0,"nb-tree-grid-row-toggle",54),2&t){const t=d.kc().$implicit;d.qc("expanded",t.expanded)}}function F(t,e){if(1&t){const t=d.Zb();d.Yb(0,"nb-checkbox",55),d.gc("checkedChange",(function(e){d.Ac(t);const a=d.kc().$implicit;return d.kc().toggle(e,a)})),d.Xb()}if(2&t){const t=d.kc().$implicit,e=d.kc();d.qc("disabled",!e.filtroStatus||"PAGO"===e.filtroStatus||"CANCELADO"===e.filtroStatus)("checked",e.isChecked(t))}}function I(t,e){if(1&t&&(d.Yb(0,"td",51),d.Gc(1,q,1,1,"nb-tree-grid-row-toggle",52),d.Gc(2,F,1,2,"nb-checkbox",53),d.Xb()),2&t){const t=e.$implicit;d.Fb(1),d.qc("ngIf",t.children),d.Fb(1),d.qc("ngIf",t.children)}}function P(t,e){if(1&t&&(d.Yb(0,"th",56),d.Ic(1," Usu\xe1rio/Produto "),d.Xb()),2&t){const t=d.kc();d.qc("nbSortHeader",t.getSortDirection("nome"))}}function A(t,e){if(1&t&&(d.Yb(0,"td",51),d.Ic(1),d.Xb()),2&t){const t=e.$implicit;d.Fb(1),d.Kc(" ",t.data.nome," ")}}function w(t,e){if(1&t&&(d.Yb(0,"th",56),d.Ic(1," Status/Qtd. Solicitada "),d.Xb()),2&t){const t=d.kc();d.qc("nbSortHeader",t.getSortDirection("uq"))}}function N(t,e){if(1&t&&(d.Yb(0,"td",51),d.Ic(1),d.Xb()),2&t){const t=e.$implicit;d.Fb(1),d.Kc(" ",t.data.uq," ")}}function O(t,e){if(1&t&&(d.Yb(0,"th",56),d.Ic(1," Valor "),d.Xb()),2&t){const t=d.kc();d.qc("nbSortHeader",t.getSortDirection("valor"))}}function j(t,e){if(1&t&&(d.Yb(0,"td",51),d.Ic(1),d.Xb()),2&t){const t=e.$implicit;d.Fb(1),d.Kc(" ",t.data.valor," ")}}function x(t,e){if(1&t&&(d.Yb(0,"th",56),d.Ic(1," Data Desejada "),d.Xb()),2&t){const t=d.kc();d.qc("nbSortHeader",t.getSortDirection("dataDesejada"))}}function y(t,e){if(1&t&&(d.Yb(0,"td",51),d.Ic(1),d.Xb()),2&t){const t=e.$implicit;d.Fb(1),d.Kc(" ",t.data.dataDesejada," ")}}function B(t,e){if(1&t){const t=d.Zb();d.Yb(0,"button",57),d.gc("click",(function(){d.Ac(t);const e=d.kc();return e.mudarPagina(e.pageNumber-1)})),d.Ic(1),d.Xb()}if(2&t){const t=d.kc();d.Fb(1),d.Kc(" ",t.pageNumber-1," ")}}function H(t,e){if(1&t){const t=d.Zb();d.Yb(0,"button",57),d.gc("click",(function(){d.Ac(t);const e=d.kc();return e.mudarPagina(e.pageNumber+1)})),d.Ic(1),d.Xb()}if(2&t){const t=d.kc();d.Fb(1),d.Kc(" ",t.pageNumber+1," ")}}let R=(()=>{class t{constructor(t,e,a,c,i,o){this.dataSourceBuilder=t,this.solicitacaoProdutoService=e,this.fb=a,this.toastrservice=c,this.dialogService=i,this.route=o,this.customColumn="nome",this.defaultColumns=[],this.allColumns=["action","nome","uq","valor","dataDesejada"],this.faSearch=u.g,this.faAngleRight=u.d,this.faAngleLeft=u.c,this.faAngleDoubleLeft=u.a,this.faAngleDoubleRight=u.b,this.nPerPage=10,this.pageNumber=1,this.filtroStatus="ABERTO",this.faExchangeAlt=u.e,this.status=Object.keys(r.d).map(t=>({k:t,v:r.d[t]})),this.sortDirection=n.ib.NONE,this.filtro=this.fb.group({dataCriacao:null,dataDesejada:null,status:null,usuario:null}),this.checkeds=new Set}ngOnInit(){return Object(o.a)(this,void 0,void 0,(function*(){this.route.queryParams.subscribe(t=>{const e=s().startOf("week"),a=s().endOf("week");if(t&&Object.keys(t).length){const{dtDjEnd:e,dtDjStart:a,status:c,usuario:i}=t;this.filtro.patchValue({status:c,dataDesejada:{start:s(a),end:s(e)},usuario:i}),this.filtroStatus=c}else this.filtro.patchValue({status:"ABERTO",dataDesejada:{start:e,end:a},usuario:""});this.solicitacaoProdutoService.buscarSolicitacoesGeral(this.filtro.value,this.pageNumber,this.nPerPage).subscribe(t=>{this.setData(t.solicitacoes),this.setLastPageAndCount(t.count)}),this.solicitacaoProdutoService.countProdutos(this.filtro.value).subscribe(t=>this.produtosCount=t)}),this.solicitacaoProdutoService.usuariosSelect().subscribe(t=>this.usuarios=t)}))}setData(t){this.data=t.map(t=>{const e=t.produtos;delete t.produtos;const a=e.map(t=>({data:{uq:t.quantidade,nome:t.produto.nome,valor:`R$ ${t.valor.toFixed(2)}`}})),c=s(t.dataDesejada).format("DD/MM/YYYY");return{data:{_id:t._id,nome:t.usuario.name,uq:r.d[t.status],valor:`R$ ${t.valorTotal.toFixed(2)}`,dataDesejada:c},children:a}}),this.dataSource=this.dataSourceBuilder.create(this.data)}buscar(){this.solicitacaoProdutoService.buscarSolicitacoesGeral(this.filtro.value,this.pageNumber,this.nPerPage).subscribe(t=>{this.setData(t.solicitacoes),this.setLastPageAndCount(t.count)}),this.solicitacaoProdutoService.countProdutos(this.filtro.value).subscribe(t=>this.produtosCount=t),this.filtroStatus=this.filtro.value.status,this.checkeds.clear()}mudarPagina(t){this.pageNumber=t,this.solicitacaoProdutoService.buscarSolicitacoes(this.filtro.value,this.pageNumber,this.nPerPage).subscribe(t=>{this.setData(t.solicitacoes),this.setLastPageAndCount(t.count)})}setLastPageAndCount(t){this.countSolicitacoes=t,this.nOfPages=Math.ceil(t/this.nPerPage)}alterarStatusTodos(){this.alterarStatus(this.data.map(t=>t.data._id))}alterarStatusSelecionados(){this.alterarStatus(Array.from(this.checkeds))}alterarStatus(t){this.dialogService.open(m,{context:{status:r.d[this.filtroStatus]}}).onClose.subscribe(e=>{e.submit&&this.solicitacaoProdutoService.alterarStatus(t,this.filtro.value.status,e.cancelamento).subscribe(t=>{this.toastrservice.success("","Status das solicita\xe7\xf5es foram alterados com sucesso"),this.buscar()})})}updateSort(t){this.sortColumn=t.column,this.sortDirection=t.direction}toggle(t,e){t?this.checkeds.add(e.data._id):this.checkeds.delete(e.data._id)}isChecked(t){return this.checkeds.has(t.data._id)}getSortDirection(t){return this.sortColumn===t?this.sortDirection:n.ib.NONE}getShowOn(t){return 400+100*t}}return t.\u0275fac=function(e){return new(e||t)(d.Sb(n.yb),d.Sb(b.a),d.Sb(l.c),d.Sb(n.pb),d.Sb(n.F),d.Sb(i.a))},t.\u0275cmp=d.Mb({type:t,selectors:[["ngx-solicitacoes-lista"]],decls:87,vars:28,consts:[["status","warning",4,"ngIf"],[1,"row"],[1,"col-md-8"],[3,"formGroup"],[1,"row","form-group"],[1,"form-group","col-md-6"],["for","Nome","required","",1,"label"],["placeholder","Status","formControlName","status","fullWidth",""],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","Usuario","required","",1,"label"],["placeholder","Usu\xe1rio","formControlName","usuario","fullWidth",""],[1,"col-md-6"],[1,"label"],["fullWidth","","nbInput","","formControlName","dataCriacao",3,"nbDatepicker"],["format","DD/MM/YYYY"],["rangepicker",""],["fullWidth","","nbInput","","formControlName","dataDesejada",3,"nbDatepicker"],["dataDesejada",""],["nbButton","","size","small",3,"click"],[2,"margin-right","5px",3,"icon"],[1,"col-md-4"],[2,"height","322px"],[2,"display","flex","justify-content","space-between"],["nbTooltip","Alterar Status","nbTooltipStatus","primary","nbButton","","status","basic","size","tiny",3,"disabled","click"],[3,"icon"],[4,"ngFor","ngForOf"],[3,"nbTreeGrid","nbSort","sort"],["nbTreeGridHeaderRow","",4,"nbTreeGridHeaderRowDef"],["nbTreeGridRow","",3,"clickToToggle",4,"nbTreeGridRowDef","nbTreeGridRowDefColumns"],["nbTreeGridColumnDef","action"],["nbTreeGridHeaderCell","",4,"nbTreeGridHeaderCellDef"],["nbTreeGridCell","",4,"nbTreeGridCellDef"],[3,"nbTreeGridColumnDef"],["nbTreeGridHeaderCell","",3,"nbSortHeader",4,"nbTreeGridHeaderCellDef"],["nbTreeGridColumnDef","uq"],["nbTreeGridColumnDef","valor"],["nbTreeGridColumnDef","dataDesejada"],["nbButton","","ghost","",3,"disabled"],[3,"icon","click"],["nbButton","","ghost","",3,"disabled","click"],["nbButton","","ghost","",3,"click",4,"ngIf"],["nbButton","","ghost","","status","primary"],["status","warning"],[3,"value"],[1,"col-md-9"],[1,"col-md-3"],["nbTreeGridHeaderRow",""],["nbTreeGridRow","",3,"clickToToggle"],["nbTreeGridHeaderCell",""],["nbTooltip","Alterar status das solicita\xe7\xf5es selecionadas","nbTooltipStatus","primary","nbButton","","status","basic","size","tiny",3,"disabled","click"],["nbTreeGridCell",""],[3,"expanded",4,"ngIf"],[3,"disabled","checked","checkedChange",4,"ngIf"],[3,"expanded"],[3,"disabled","checked","checkedChange"],["nbTreeGridHeaderCell","",3,"nbSortHeader"],["nbButton","","ghost","",3,"click"]],template:function(t,e){if(1&t&&(d.Gc(0,S,2,0,"nb-alert",0),d.Gc(1,Y,2,0,"nb-alert",0),d.Gc(2,v,2,0,"nb-alert",0),d.Yb(3,"div",1),d.Yb(4,"div",2),d.Yb(5,"nb-card"),d.Yb(6,"nb-card-header"),d.Ic(7," Filtro de Solicita\xe7\xf5es "),d.Xb(),d.Yb(8,"nb-card-body"),d.Yb(9,"form",3),d.Yb(10,"div",4),d.Yb(11,"div",5),d.Yb(12,"label",6),d.Ic(13,"Status"),d.Xb(),d.Yb(14,"nb-select",7),d.Yb(15,"nb-option",8),d.Ic(16,"Todos"),d.Xb(),d.Gc(17,k,2,2,"nb-option",9),d.Xb(),d.Xb(),d.Yb(18,"div",5),d.Yb(19,"label",10),d.Ic(20,"Usu\xe1rio"),d.Xb(),d.Yb(21,"nb-select",11),d.Yb(22,"nb-option",8),d.Ic(23,"Todos"),d.Xb(),d.Gc(24,X,2,2,"nb-option",9),d.Xb(),d.Xb(),d.Xb(),d.Yb(25,"div",1),d.Yb(26,"div",12),d.Yb(27,"label",13),d.Ic(28,"Data de cria\xe7\xe3o:"),d.Xb(),d.Tb(29,"input",14),d.Tb(30,"nb-rangepicker",15,16),d.Xb(),d.Yb(32,"div",12),d.Yb(33,"label",13),d.Ic(34,"Data desejada:"),d.Xb(),d.Tb(35,"input",17),d.Tb(36,"nb-rangepicker",15,18),d.Xb(),d.Xb(),d.Xb(),d.Xb(),d.Yb(38,"nb-card-footer"),d.Yb(39,"button",19),d.gc("click",(function(){return e.buscar()})),d.Tb(40,"fa-icon",20),d.Ic(41," Buscar"),d.Xb(),d.Xb(),d.Xb(),d.Xb(),d.Yb(42,"div",21),d.Yb(43,"nb-card",22),d.Yb(44,"nb-card-header"),d.Yb(45,"div",23),d.Yb(46,"div"),d.Ic(47," Produto / Quantidade "),d.Xb(),d.Yb(48,"div"),d.Yb(49,"button",24),d.gc("click",(function(){return e.alterarStatusTodos()})),d.Tb(50,"fa-icon",25),d.Xb(),d.Xb(),d.Xb(),d.Xb(),d.Yb(51,"nb-card-body"),d.Yb(52,"nb-list"),d.Gc(53,C,5,2,"nb-list-item",26),d.Xb(),d.Xb(),d.Xb(),d.Xb(),d.Xb(),d.Yb(54,"nb-card"),d.Yb(55,"nb-card-body"),d.Yb(56,"table",27),d.gc("sort",(function(t){return e.updateSort(t)})),d.Gc(57,D,1,0,"tr",28),d.Gc(58,G,1,1,"tr",29),d.Wb(59,30),d.Gc(60,T,3,2,"th",31),d.Gc(61,I,3,2,"td",32),d.Vb(),d.Wb(62,33),d.Gc(63,P,2,1,"th",34),d.Gc(64,A,2,1,"td",32),d.Vb(),d.Wb(65,35),d.Gc(66,w,2,1,"th",34),d.Gc(67,N,2,1,"td",32),d.Vb(),d.Wb(68,36),d.Gc(69,O,2,1,"th",34),d.Gc(70,j,2,1,"td",32),d.Vb(),d.Wb(71,37),d.Gc(72,x,2,1,"th",34),d.Gc(73,y,2,1,"td",32),d.Vb(),d.Xb(),d.Xb(),d.Yb(74,"nb-card-footer"),d.Yb(75,"button",38),d.Yb(76,"fa-icon",39),d.gc("click",(function(){return e.mudarPagina(1)})),d.Xb(),d.Xb(),d.Yb(77,"button",40),d.gc("click",(function(){return e.mudarPagina(e.pageNumber-2)})),d.Tb(78,"fa-icon",25),d.Xb(),d.Gc(79,B,2,1,"button",41),d.Yb(80,"button",42),d.Ic(81),d.Xb(),d.Gc(82,H,2,1,"button",41),d.Yb(83,"button",40),d.gc("click",(function(){return e.mudarPagina(e.pageNumber+2)})),d.Tb(84,"fa-icon",25),d.Xb(),d.Yb(85,"button",40),d.gc("click",(function(){return e.mudarPagina(e.nOfPages)})),d.Tb(86,"fa-icon",25),d.Xb(),d.Xb(),d.Xb()),2&t){const t=d.xc(31),a=d.xc(37);d.qc("ngIf",!e.filtroStatus),d.Fb(1),d.qc("ngIf","PAGO"===e.filtroStatus),d.Fb(1),d.qc("ngIf","CANCELADO"===e.filtroStatus),d.Fb(7),d.qc("formGroup",e.filtro),d.Fb(8),d.qc("ngForOf",e.status),d.Fb(7),d.qc("ngForOf",e.usuarios),d.Fb(5),d.qc("nbDatepicker",t),d.Fb(6),d.qc("nbDatepicker",a),d.Fb(5),d.qc("icon",e.faSearch),d.Fb(9),d.qc("disabled",!e.filtroStatus||"PAGO"===e.filtroStatus||"CANCELADO"===e.filtroStatus),d.Fb(1),d.qc("icon",e.faExchangeAlt),d.Fb(3),d.qc("ngForOf",e.produtosCount),d.Fb(3),d.qc("nbTreeGrid",e.dataSource)("nbSort",e.dataSource),d.Fb(1),d.qc("nbTreeGridHeaderRowDef",e.allColumns),d.Fb(1),d.qc("nbTreeGridRowDefColumns",e.allColumns),d.Fb(4),d.qc("nbTreeGridColumnDef",e.customColumn),d.Fb(13),d.qc("disabled",1===e.pageNumber),d.Fb(1),d.qc("icon",e.faAngleDoubleLeft),d.Fb(1),d.qc("disabled",e.pageNumber<=2),d.Fb(1),d.qc("icon",e.faAngleLeft),d.Fb(1),d.qc("ngIf",e.pageNumber>1),d.Fb(2),d.Kc(" ",e.pageNumber," "),d.Fb(1),d.qc("ngIf",e.pageNumber<e.nOfPages),d.Fb(1),d.qc("disabled",e.pageNumber>=e.nOfPages-2),d.Fb(1),d.qc("icon",e.faAngleRight),d.Fb(1),d.qc("disabled",e.pageNumber===e.nOfPages),d.Fb(1),d.qc("icon",e.faAngleDoubleRight)}},directives:[c.m,n.p,n.s,n.o,l.z,l.o,l.g,n.db,l.n,l.f,n.ab,c.l,n.K,l.b,n.B,n.bb,n.q,n.l,p.a,n.sb,n.T,n.xb,n.jb,n.Cb,n.Fb,n.wb,n.zb,n.ub,n.j,n.U,n.Bb,n.Eb,n.Ab,n.vb,n.Gb,n.v,n.kb],styles:[""]}),t})();var E=a("zQsl"),L=a("DKVz"),$=a("eW8b");let W=(()=>{class t{}return t.\u0275mod=d.Qb({type:t}),t.\u0275inj=d.Pb({factory:function(e){return new(e||t)},imports:[[c.c,n.m,n.t,E.c,L.a,n.eb,n.L,n.t,n.f,n.k,l.u,l.h,n.C,n.Db,n.V,n.J,p.b,$.a,n.tb,n.w,n.D.forChild(),i.g.forChild([{path:"",component:R}])]]}),t})()}}]);